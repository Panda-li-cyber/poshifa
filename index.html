<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç ´åæ³•è®¡ç®—ç»ƒä¹ </title>
    <style>
        body {
            font-family: 'Comic Sans MS', 'æ¥·ä½“', sans-serif;
            background-color: #f0f9ff;
            text-align: center;
            margin: 0;
            padding: 20px;
            background-image: url('https://img.freepik.com/free-vector/hand-drawn-colorful-doodle-background_23-2149015287.jpg');
            background-size: cover;
            background-attachment: fixed;
            min-height: 100vh;
            overflow-y: auto;
        }
        
        .container {
            max-width: 500px;
            margin: 0 auto;
            background-color: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border-radius: 20px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
            border: 3px solid #4CAF50;
            position: relative;
            z-index: 10;
            margin-bottom: 30px;
        }
        
        h1 {
            color: #FF6B6B;
            font-size: 28px;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .name-input {
            margin: 15px 0;
        }
        
        input[type="text"] {
            padding: 8px 12px;
            font-size: 16px;
            border: 2px solid #4CAF50;
            border-radius: 20px;
            width: 60%;
            text-align: center;
            outline: none;
        }
        
        .question-area {
            margin: 20px 0;
            min-height: 180px;
        }
        
        .question {
            font-size: 32px;
            margin-bottom: 15px;
        }
        
        .question-number {
            font-size: 18px;
            color: #666;
            margin-bottom: 8px;
        }
        
        .answer-display {
            display: inline-block;
            min-width: 50px;
            height: 35px;
            font-size: 22px;
            text-align: center;
            border-bottom: 2px solid #4CAF50;
            margin: 0 5px;
            vertical-align: middle;
        }
        
        .number-pad {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
            max-width: 300px;
            margin: 0 auto;
        }
        
        .number-btn {
            padding: 8px;
            font-size: 18px;
            border: none;
            border-radius: 8px;
            background-color: #FFD166;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .number-btn:hover {
            background-color: #FFB347;
        }
        
        .feedback {
            font-size: 22px;
            margin: 15px 0;
            min-height: 30px;
            height: 30px;
        }
        
        .correct {
            color: #06D6A0;
            font-weight: bold;
        }
        
        .incorrect {
            color: #EF476F;
            font-weight: bold;
        }
        
        .progress {
            margin-top: 15px;
            font-size: 16px;
            color: #666;
        }
        
        .score-display {
            display: flex;
            justify-content: space-around;
            margin: 15px 0;
            font-size: 16px;
        }
        
        .score-box {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 8px;
            min-width: 80px;
        }
        
        .final-result {
            font-size: 22px;
            margin-top: 25px;
            display: none;
        }
        
        .time {
            color: blue;
        }
        
        .score {
            color: red;
            font-weight: bold;
        }
        
        .emoji {
            font-size: 26px;
            margin: 0 4px;
        }
        
        .restart-btn, .screenshot-btn, .hint-btn, .submit-btn {
            padding: 10px 20px;
            font-size: 16px;
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            margin: 10px 5px;
            font-weight: bold;
        }
        
        .submit-btn {
            background-color: #4CAF50;
        }
        
        .screenshot-btn {
            background-color: #3498db;
        }
        
        .hint-btn {
            background-color: #9b59b6;
        }
        
        .restart-btn {
            background-color: #e74c3c;
        }
        
        .explanation {
            background-color: #f8f9fa;
            border: 1px dashed #4CAF50;
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            text-align: center;
            font-size: 18px;
        }
        
        .step {
            margin: 10px 0;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .arrow {
            font-size: 24px;
            margin: 0 10px;
        }
        
        .confetti {
            position: fixed;
            width: 8px;
            height: 8px;
            background-color: #f00;
            border-radius: 50%;
            animation: fall 5s linear infinite;
            z-index: 1;
        }
        
        @keyframes fall {
            to {
                transform: translateY(100vh) rotate(360deg);
            }
        }
        
        .formula {
            font-weight: bold;
            color: #e74c3c;
            margin-top: 15px;
            padding: 10px;
            background-color: #f9f9f9;
            border-radius: 10px;
        }
        
        .button-group {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ç ´åæ³•è®¡ç®—ç»ƒä¹  <span class="emoji">ğŸ§®</span></h1>
        
        <div class="name-input">
            <input type="text" id="studentName" placeholder="è¯·è¾“å…¥ä½ çš„åå­—">
        </div>
        
        <div class="score-display">
            <div class="score-box">
                å¾—åˆ†: <span id="score">0</span>/100
            </div>
            <div class="score-box">
                ç”¨æ—¶: <span id="timer">0åˆ†0ç§’</span>
            </div>
        </div>
        
        <div class="question-area" id="questionArea">
            <p>ç‚¹å‡»å¼€å§‹æŒ‰é’®å¼€å§‹æµ‹è¯•</p>
            <button class="restart-btn" id="startBtn">å¼€å§‹</button>
        </div>
        
        <div class="progress" id="progress">
            é¢˜ç›®: 0/10 | å½“å‰å¾—åˆ†: 0
        </div>
        
        <div class="final-result" id="finalResult">
        </div>
    </div>

    <audio id="correctSound" src="https://www.soundjay.com/human/sounds/applause-8.mp3" preload="auto"></audio>
    <audio id="wrongSound" src="https://www.soundjay.com/buttons/sounds/button-10.mp3" preload="auto"></audio>
    <audio id="celebrationSound" src="https://www.soundjay.com/human/sounds/applause-01.mp3" preload="auto"></audio>

    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script>
        // å…¨å±€å˜é‡
        let score = 0;
        let questionCount = 0;
        let startTime = null;
        let testStartTime = null;
        let currentAnswer = '';
        let testCompleted = false;
        let currentA = 0;
        let currentB = 0;
        let timerInterval = null;
        
        // DOMå…ƒç´ 
        const questionArea = document.getElementById('questionArea');
        const studentNameInput = document.getElementById('studentName');
        const progressElement = document.getElementById('progress');
        const finalResultElement = document.getElementById('finalResult');
        const scoreElement = document.getElementById('score');
        const timerElement = document.getElementById('timer');
        const correctSound = document.getElementById('correctSound');
        const wrongSound = document.getElementById('wrongSound');
        const celebrationSound = document.getElementById('celebrationSound');
        const startBtn = document.getElementById('startBtn');
        
        // å¼€å§‹æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        startBtn.addEventListener('click', () => {
            startTest();
        });
        
        // å¼€å§‹æµ‹è¯•
        function startTest() {
            // æ£€æŸ¥æ˜¯å¦è¾“å…¥äº†åå­—
            const studentName = studentNameInput.value.trim();
            if (!studentName) {
                alert('è¯·è¾“å…¥ä½ çš„åå­—å†å¼€å§‹æµ‹è¯•å“¦ï¼');
                return;
            }
            
            // é‡ç½®çŠ¶æ€
            questionCount = 0;
            score = 0;
            startTime = null;
            testStartTime = null;
            currentAnswer = '';
            testCompleted = false;
            clearInterval(timerInterval);
            
            // æ›´æ–°æ˜¾ç¤º
            scoreElement.textContent = score;
            timerElement.textContent = '0åˆ†0ç§’';
            progressElement.textContent = 'é¢˜ç›®: 0/10 | å½“å‰å¾—åˆ†: 0';
            finalResultElement.style.display = 'none';
            
            // å¼€å§‹ç¬¬ä¸€é¢˜
            generateQuestion();
        }
        
        // æ›´æ–°è®¡æ—¶å™¨
        function updateTimer() {
            if (!testStartTime) return;
            
            const now = new Date();
            const timeDiff = (now - testStartTime) / 1000; // ç§’æ•°
            const minutes = Math.floor(timeDiff / 60);
            const seconds = Math.floor(timeDiff % 60);
            
            timerElement.textContent = `${minutes}åˆ†${seconds}ç§’`;
        }
        
        // ç”Ÿæˆé¢˜ç›®
        function generateQuestion() {
            if (questionCount >= 10) {
                showFinalResult();
                return;
            }
            
            questionCount++;
            currentAnswer = '';
            
            // ç”Ÿæˆéšæœºé¢˜ç›®ï¼š11-15å‡å»6-9
            currentA = Math.floor(Math.random() * 5) + 11; // 11-15
            currentB = Math.floor(Math.random() * 4) + 6;  // 6-9
            
            // åˆ›å»ºé¢˜ç›®HTML
            questionArea.innerHTML = `
                <div class="question-number">ç¬¬ ${questionCount} é¢˜</div>
                <div class="question">${currentA} - ${currentB} = <span class="answer-display" id="answerDisplay"></span></div>
                <div class="number-pad" id="numberPad">
                    <button class="number-btn">1</button>
                    <button class="number-btn">2</button>
                    <button class="number-btn">3</button>
                    <button class="number-btn">4</button>
                    <button class="number-btn">5</button>
                    <button class="number-btn">6</button>
                    <button class="number-btn">7</button>
                    <button class="number-btn">8</button>
                    <button class="number-btn">9</button>
                    <button class="number-btn">0</button>
                </div>
                <div class="feedback" id="feedback"></div>
                <div class="button-group">
                    <button class="hint-btn" id="hintBtn">æç¤º</button>
                    <button class="submit-btn" id="submitBtn">æäº¤</button>
                </div>
                <div class="explanation" id="explanation" style="display:none"></div>
            `;
            
            // è·å–æ–°åˆ›å»ºçš„DOMå…ƒç´ 
            const answerDisplay = document.getElementById('answerDisplay');
            const numberPad = document.getElementById('numberPad');
            const feedbackElement = document.getElementById('feedback');
            const explanationElement = document.getElementById('explanation');
            const submitBtn = document.getElementById('submitBtn');
            const hintBtn = document.getElementById('hintBtn');
            
            // æ•°å­—æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            numberPad.querySelectorAll('.number-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    // ç¬¬ä¸€æ¬¡è¾“å…¥æ—¶å¼€å§‹è®¡æ—¶
                    if (!testStartTime) {
                        testStartTime = new Date();
                        timerInterval = setInterval(updateTimer, 1000);
                    }
                    
                    currentAnswer += btn.textContent;
                    answerDisplay.textContent = currentAnswer;
                });
            });
            
            // æç¤ºæŒ‰é’®
            hintBtn.addEventListener('click', () => {
                showExplanation();
                // æ»šåŠ¨åˆ°è§£é‡Šéƒ¨åˆ†
                explanationElement.scrollIntoView({ behavior: 'smooth' });
            });
            
            // æäº¤æŒ‰é’®
            submitBtn.addEventListener('click', () => {
                checkAnswer();
            });
            
            // æ›´æ–°è¿›åº¦
            updateProgress();
        }
        
        // æ£€æŸ¥ç­”æ¡ˆ
        function checkAnswer() {
            const userAnswer = parseInt(currentAnswer) || 0;
            const correctAnswer = currentA - currentB;
            const answerDisplay = document.getElementById('answerDisplay');
            const feedbackElement = document.getElementById('feedback');
            const explanationElement = document.getElementById('explanation');
            
            if (userAnswer === correctAnswer) {
                // æ’­æ”¾æ­£ç¡®éŸ³æ•ˆ
                correctSound.play();
                
                feedbackElement.textContent = 'æ­£ç¡®ï¼Œä½ çœŸæ£’ï¼';
                feedbackElement.className = 'feedback correct';
                
                // éšè—è§£é‡Š
                explanationElement.style.display = 'none';
                
                // æ›´æ–°åˆ†æ•°
                score += 10;
                scoreElement.textContent = score;
                
                // æ›´æ–°è¿›åº¦
                updateProgress();
                
                // 0.5ç§’åç”Ÿæˆä¸‹ä¸€é¢˜
                setTimeout(() => {
                    currentAnswer = '';
                    generateQuestion();
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                }, 500);
            } else {
                // æ’­æ”¾é”™è¯¯éŸ³æ•ˆ
                wrongSound.play();
                
                feedbackElement.textContent = 'ä¸å¯¹ï¼Œå†æƒ³æƒ³ï¼';
                feedbackElement.className = 'feedback incorrect';
                
                // æ¸…ç©ºç­”æ¡ˆ
                currentAnswer = '';
                answerDisplay.textContent = '';
            }
        }
        
        // æ˜¾ç¤ºè®¡ç®—æ­¥éª¤
        function showExplanation() {
            const explanationElement = document.getElementById('explanation');
            const remainder = 10 - currentB;
            
            explanationElement.innerHTML = `
                <p><strong>ç ´åæ³•è®¡ç®—è¿‡ç¨‹ï¼š</strong></p>
                <div class="step">
                    <span>${currentA} = 10 + ${currentA - 10}</span>
                </div>
                <div class="step">
                    <span>10 - ${currentB} = ${10 - currentB}</span>
                </div>
                <div class="step">
                    <span>${10 - currentB} + ${currentA - 10} = ${currentA - currentB}</span>
                </div>
                <div class="step">
                    <span>æ­£ç¡®ç­”æ¡ˆï¼š${currentA} - ${currentB} = ${currentA - currentB}</span>
                </div>
                <div class="formula">
                    ç ´åæ³•å£è¯€ï¼š<br>
                    æ‹†å¤§æ•°ï¼Œåˆ†å‡º10ï¼Œ<br>
                    å‡å°æ•°ï¼ŒåŠ å‰©æ•°ï¼
                </div>
            `;
            
            explanationElement.style.display = 'block';
        }
        
        // æ›´æ–°è¿›åº¦
        function updateProgress() {
            progressElement.textContent = `é¢˜ç›®: ${questionCount}/10 | å½“å‰å¾—åˆ†: ${score}`;
        }
        
        // åˆ›å»ºå½©å¸¦æ•ˆæœ
        function createConfetti() {
            const colors = ['#f00', '#0f0', '#00f', '#ff0', '#f0f', '#0ff'];
            for (let i = 0; i < 100; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.width = Math.random() * 10 + 5 + 'px';
                confetti.style.height = Math.random() * 10 + 5 + 'px';
                confetti.style.animationDuration = Math.random() * 3 + 2 + 's';
                confetti.style.animationDelay = Math.random() * 2 + 's';
                document.body.appendChild(confetti);
                
                // 5ç§’åç§»é™¤å½©å¸¦
                setTimeout(() => {
                    confetti.remove();
                }, 5000);
            }
        }
        
        // æ˜¾ç¤ºæœ€ç»ˆç»“æœ
        function showFinalResult() {
            clearInterval(timerInterval);
            testCompleted = true;
            const endTime = new Date();
            const timeDiff = (endTime - testStartTime) / 1000; // ç§’æ•°
            const minutes = Math.floor(timeDiff / 60);
            const seconds = Math.floor(timeDiff % 60);
            
            // æ’­æ”¾åº†ç¥éŸ³æ•ˆ
            celebrationSound.play();
            
            // åˆ›å»ºå½©å¸¦æ•ˆæœ
            createConfetti();
            
            finalResultElement.innerHTML = `
                <p>æ­å–œ<span class="emoji">ğŸ‰</span><strong>${studentNameInput.value}</strong><span class="emoji">ğŸ‰</span>åŒå­¦ï¼</p>
                <p>ç”¨æ—¶: <span class="time">${minutes}åˆ†${seconds}ç§’</span></p>
                <p>å¾—åˆ†: <span class="score">${score}åˆ†</span></p>
                <p>ä½ çœŸæ£’<span class="emoji">ğŸ‘</span>ï¼</p>
                <div class="button-group">
                    <button class="restart-btn" id="restartBtn">å†æ¥ä¸€æ¬¡</button>
                    <button class="screenshot-btn" id="screenshotBtn">æ‹ç…§ç•™å¿µ</button>
                </div>
            `;
            
            finalResultElement.style.display = 'block';
            questionArea.innerHTML = '<p>æµ‹è¯•å®Œæˆï¼</p>';
            
            // æ‹ç…§ç•™å¿µæŒ‰é’®
            document.getElementById('screenshotBtn').addEventListener('click', () => {
                // åªæˆªå–æœ€ç»ˆç»“æœéƒ¨åˆ†
                const resultContainer = document.createElement('div');
                resultContainer.className = 'container';
                resultContainer.style.maxWidth = '500px';
                resultContainer.style.margin = '0 auto';
                resultContainer.style.padding = '20px';
                resultContainer.style.backgroundColor = 'rgba(255, 255, 255, 0.9)';
                resultContainer.style.borderRadius = '20px';
                resultContainer.style.boxShadow = '0 0 15px rgba(0, 0, 0, 0.1)';
                resultContainer.style.border = '3px solid #4CAF50';
                
                resultContainer.innerHTML = finalResultElement.innerHTML.replace('id="restartBtn"', '').replace('id="screenshotBtn"', '');
                
                const oldDisplay = finalResultElement.style.display;
                finalResultElement.style.display = 'none';
                
                document.body.appendChild(resultContainer);
                
                html2canvas(resultContainer).then(canvas => {
                    const link = document.createElement('a');
                    link.download = 'ç ´åæ³•ç»ƒä¹ æˆç»©.png';
                    link.href = canvas.toDataURL();
                    link.click();
                    document.body.removeChild(resultContainer);
                    finalResultElement.style.display = oldDisplay;
                });
            });
            
            // å†æ¥ä¸€æ¬¡æŒ‰é’®
            document.getElementById('restartBtn').addEventListener('click', () => {
                // æ¸…é™¤æ‰€æœ‰å½©å¸¦
                document.querySelectorAll('.confetti').forEach(el => el.remove());
                
                // é‡ç½®æµ‹è¯•çŠ¶æ€
                questionCount = 0;
                score = 0;
                currentAnswer = '';
                testCompleted = false;
                testStartTime = null;
                clearInterval(timerInterval);
                
                // æ›´æ–°æ˜¾ç¤º
                scoreElement.textContent = '0';
                timerElement.textContent = '0åˆ†0ç§’';
                finalResultElement.style.display = 'none';
                progressElement.textContent = 'é¢˜ç›®: 0/10 | å½“å‰å¾—åˆ†: 0';
                
                // ä¿ç•™å­¦ç”Ÿå§“åï¼Œé‡æ–°å¼€å§‹æµ‹è¯•
                questionArea.innerHTML = `
                    <p>ç‚¹å‡»å¼€å§‹æŒ‰é’®é‡æ–°æµ‹è¯•</p>
                    <button class="restart-btn" id="startBtn">å¼€å§‹</button>
                `;
                
                // é‡æ–°ç»‘å®šå¼€å§‹æŒ‰é’®äº‹ä»¶
                document.getElementById('startBtn').addEventListener('click', startTest);
                
                // æ»šåŠ¨åˆ°é¡¶éƒ¨
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });
        }
    </script>
</body>
</html>